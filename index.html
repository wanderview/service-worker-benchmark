<!DOCTYPE html>
<html>
<head>
  <title>SW speed test</title>
  <style>
    .images {
      display: flex;
      flex-flow: row wrap;
      width: 400px;
      background: #ccc;
    }
    .images img {
      width: 20px;
      height: 20px;
    }
  </style>
</head>
<body>
  <h1>SW Benchmark</h1>
  <div class="images">
    <img src="images/0.png">
    <img src="images/1.png">
    <img src="images/2.png">
    <img src="images/3.png">
    <img src="images/4.png">
    <img src="images/5.png">
    <img src="images/6.png">
    <img src="images/7.png">
    <img src="images/8.png">
    <img src="images/9.png">
    <img src="images/10.png">
    <img src="images/11.png">
    <img src="images/12.png">
    <img src="images/13.png">
    <img src="images/14.png">
    <img src="images/15.png">
    <img src="images/16.png">
    <img src="images/17.png">
    <img src="images/18.png">
    <img src="images/19.png">
    <img src="images/20.png">
    <img src="images/21.png">
    <img src="images/22.png">
    <img src="images/23.png">
    <img src="images/24.png">
    <img src="images/25.png">
    <img src="images/26.png">
    <img src="images/27.png">
    <img src="images/28.png">
    <img src="images/29.png">
    <img src="images/30.png">
    <img src="images/31.png">
    <img src="images/32.png">
    <img src="images/33.png">
    <img src="images/34.png">
    <img src="images/35.png">
    <img src="images/36.png">
    <img src="images/37.png">
    <img src="images/38.png">
    <img src="images/39.png">
    <img src="images/40.png">
    <img src="images/41.png">
    <img src="images/42.png">
    <img src="images/43.png">
    <img src="images/44.png">
    <img src="images/45.png">
    <img src="images/46.png">
    <img src="images/47.png">
    <img src="images/48.png">
    <img src="images/49.png">
    <img src="images/50.png">
    <img src="images/51.png">
    <img src="images/52.png">
    <img src="images/53.png">
    <img src="images/54.png">
    <img src="images/55.png">
    <img src="images/56.png">
    <img src="images/57.png">
    <img src="images/58.png">
    <img src="images/59.png">
    <img src="images/60.png">
    <img src="images/61.png">
    <img src="images/62.png">
    <img src="images/63.png">
    <img src="images/64.png">
    <img src="images/65.png">
    <img src="images/66.png">
    <img src="images/67.png">
    <img src="images/68.png">
    <img src="images/69.png">
    <img src="images/70.png">
    <img src="images/71.png">
    <img src="images/72.png">
    <img src="images/73.png">
    <img src="images/74.png">
    <img src="images/75.png">
    <img src="images/76.png">
    <img src="images/77.png">
    <img src="images/78.png">
    <img src="images/79.png">
    <img src="images/80.png">
    <img src="images/81.png">
    <img src="images/82.png">
    <img src="images/83.png">
    <img src="images/84.png">
    <img src="images/85.png">
    <img src="images/86.png">
    <img src="images/87.png">
    <img src="images/88.png">
    <img src="images/89.png">
    <img src="images/90.png">
    <img src="images/91.png">
    <img src="images/92.png">
    <img src="images/93.png">
    <img src="images/94.png">
    <img src="images/95.png">
    <img src="images/96.png">
    <img src="images/97.png">
    <img src="images/98.png">
    <img src="images/99.png">
    <img src="images/100.png">
    <img src="images/101.png">
    <img src="images/102.png">
    <img src="images/103.png">
    <img src="images/104.png">
    <img src="images/105.png">
    <img src="images/106.png">
    <img src="images/107.png">
    <img src="images/108.png">
    <img src="images/109.png">
    <img src="images/110.png">
    <img src="images/111.png">
    <img src="images/112.png">
    <img src="images/113.png">
    <img src="images/114.png">
    <img src="images/115.png">
    <img src="images/116.png">
    <img src="images/117.png">
    <img src="images/118.png">
    <img src="images/119.png">
    <img src="images/120.png">
    <img src="images/121.png">
    <img src="images/122.png">
    <img src="images/123.png">
    <img src="images/124.png">
    <img src="images/125.png">
    <img src="images/126.png">
    <img src="images/127.png">
    <img src="images/128.png">
    <img src="images/129.png">
    <img src="images/130.png">
    <img src="images/131.png">
    <img src="images/132.png">
    <img src="images/133.png">
    <img src="images/134.png">
    <img src="images/135.png">
    <img src="images/136.png">
    <img src="images/137.png">
    <img src="images/138.png">
    <img src="images/139.png">
    <img src="images/140.png">
    <img src="images/141.png">
    <img src="images/142.png">
    <img src="images/143.png">
    <img src="images/144.png">
    <img src="images/145.png">
    <img src="images/146.png">
    <img src="images/147.png">
    <img src="images/148.png">
    <img src="images/149.png">
    <img src="images/150.png">
    <img src="images/151.png">
    <img src="images/152.png">
    <img src="images/153.png">
    <img src="images/154.png">
    <img src="images/155.png">
    <img src="images/156.png">
    <img src="images/157.png">
    <img src="images/158.png">
    <img src="images/159.png">
    <img src="images/160.png">
    <img src="images/161.png">
    <img src="images/162.png">
    <img src="images/163.png">
    <img src="images/164.png">
    <img src="images/165.png">
    <img src="images/166.png">
    <img src="images/167.png">
    <img src="images/168.png">
    <img src="images/169.png">
    <img src="images/170.png">
    <img src="images/171.png">
    <img src="images/172.png">
    <img src="images/173.png">
    <img src="images/174.png">
    <img src="images/175.png">
    <img src="images/176.png">
    <img src="images/177.png">
    <img src="images/178.png">
    <img src="images/179.png">
    <img src="images/180.png">
    <img src="images/181.png">
    <img src="images/182.png">
    <img src="images/183.png">
    <img src="images/184.png">
    <img src="images/185.png">
    <img src="images/186.png">
    <img src="images/187.png">
    <img src="images/188.png">
    <img src="images/189.png">
    <img src="images/190.png">
    <img src="images/191.png">
    <img src="images/192.png">
    <img src="images/193.png">
    <img src="images/194.png">
    <img src="images/195.png">
    <img src="images/196.png">
    <img src="images/197.png">
    <img src="images/198.png">
    <img src="images/199.png">
    <img src="images/200.png">
    <img src="images/201.png">
    <img src="images/202.png">
    <img src="images/203.png">
    <img src="images/204.png">
    <img src="images/205.png">
    <img src="images/206.png">
    <img src="images/207.png">
    <img src="images/208.png">
    <img src="images/209.png">
    <img src="images/210.png">
    <img src="images/211.png">
    <img src="images/212.png">
    <img src="images/213.png">
    <img src="images/214.png">
    <img src="images/215.png">
    <img src="images/216.png">
    <img src="images/217.png">
    <img src="images/218.png">
    <img src="images/219.png">
    <img src="images/220.png">
    <img src="images/221.png">
    <img src="images/222.png">
    <img src="images/223.png">
    <img src="images/224.png">
    <img src="images/225.png">
    <img src="images/226.png">
    <img src="images/227.png">
    <img src="images/228.png">
    <img src="images/229.png">
    <img src="images/230.png">
    <img src="images/231.png">
    <img src="images/232.png">
    <img src="images/233.png">
    <img src="images/234.png">
    <img src="images/235.png">
    <img src="images/236.png">
    <img src="images/237.png">
    <img src="images/238.png">
    <img src="images/239.png">
    <img src="images/240.png">
    <img src="images/241.png">
    <img src="images/242.png">
    <img src="images/243.png">
    <img src="images/244.png">
    <img src="images/245.png">
    <img src="images/246.png">
    <img src="images/247.png">
    <img src="images/248.png">
    <img src="images/249.png">
    <img src="images/250.png">
    <img src="images/251.png">
    <img src="images/252.png">
    <img src="images/253.png">
    <img src="images/254.png">
    <img src="images/255.png">
    <img src="images/256.png">
    <img src="images/257.png">
    <img src="images/258.png">
    <img src="images/259.png">
    <img src="images/260.png">
    <img src="images/261.png">
    <img src="images/262.png">
    <img src="images/263.png">
    <img src="images/264.png">
    <img src="images/265.png">
    <img src="images/266.png">
    <img src="images/267.png">
    <img src="images/268.png">
    <img src="images/269.png">
    <img src="images/270.png">
    <img src="images/271.png">
    <img src="images/272.png">
    <img src="images/273.png">
    <img src="images/274.png">
    <img src="images/275.png">
    <img src="images/276.png">
    <img src="images/277.png">
    <img src="images/278.png">
    <img src="images/279.png">
    <img src="images/280.png">
    <img src="images/281.png">
    <img src="images/282.png">
    <img src="images/283.png">
    <img src="images/284.png">
    <img src="images/285.png">
    <img src="images/286.png">
    <img src="images/287.png">
    <img src="images/288.png">
    <img src="images/289.png">
    <img src="images/290.png">
    <img src="images/291.png">
    <img src="images/292.png">
    <img src="images/293.png">
    <img src="images/294.png">
    <img src="images/295.png">
    <img src="images/296.png">
    <img src="images/297.png">
    <img src="images/298.png">
    <img src="images/299.png">
  </div>
  <div class="results"></div>
  <div class="sw-status"></div>
  <div class="controls"></div>
  <script>
    window.onload = () => {
      const timing = performance.timing;
      const controls = document.querySelector('.controls');
      const swStatus = document.querySelector('.sw-status');
      const sw = navigator.serviceWorker;

      document.querySelector('.results').textContent = `${timing.loadEventStart - timing.navigationStart}ms from nav start to onload start`;

      function logActiveWorker() {
        sw.getRegistration().then(reg => {
          if (!reg) {
            swStatus.textContent = 'No service worker';
            return;
          }
          if (!reg.active) {
            watchUpdate(reg);
            return;
          }
          swStatus.textContent = `${/\/([^\/]+)$/.exec(reg.active.scriptURL)[1]} active`;
        });
      }

      logActiveWorker();

      function watchUpdate(reg) {
        const worker = reg.installing;

        if (!worker) {
          swStatus.textContent = 'Already installed';
          return;
        }

        swStatus.textContent = 'Installing';

        worker.addEventListener('statechange', function listener() {
          if (worker.state == 'activated') {
            logActiveWorker();
            worker.removeEventListener('statechange', listener);
          }
          else if (worker.state == 'redundant') {
            updateError();
          }
        });
      }

      function updateError() {
        swStatus.textContent = 'Update error';
      }

      function createButton(text, event) {
        const button = document.createElement('button');
        button.textContent = text;
        button.onclick = event;
        return button;
      }

      controls.appendChild(createButton("Unregister", () => {
        sw.getRegistration().then(r => r && r.unregister())
          .then(() => swStatus.textContent = 'Unregistered');
      }));

      controls.appendChild(createButton("Register no-fetch worker", () => {
        sw.register('no-fetch.js').then(watchUpdate, updateError);
      }));

      controls.appendChild(createButton("Register empty-fetch worker", () => {
        sw.register('empty-fetch.js').then(watchUpdate, updateError);
      }));

      controls.appendChild(createButton("Register pass-through worker", () => {
        sw.register('pass-through-fetch.js').then(watchUpdate, updateError);
      }));

      controls.appendChild(createButton("Register blocking worker", () => {
        sw.register('blocking-fetch.js').then(watchUpdate, updateError);
      }));

      controls.appendChild(createButton("Register caching worker", () => {
        sw.register('cached-fetch.js').then(watchUpdate, updateError);
      }));

      controls.appendChild(createButton("Register data-url-fetch worker", () => {
        // this is a long one…
        swStatus.textContent = 'Registering…';
        sw.register('data-url-fetch.js').then(watchUpdate, updateError);
      }));

      controls.appendChild(createButton("Register streaming-fetch worker", () => {
        sw.register('streaming-fetch.js').then(watchUpdate, updateError);
      }));

      controls.appendChild(createButton("Register preloading pass-through worker", () => {
        sw.register('preloading-pass-through-fetch.js').then(watchUpdate, updateError);
      }));

      controls.appendChild(createButton("Register preloading caching worker", () => {
        sw.register('preloading-cached-fetch.js').then(watchUpdate, updateError);
      }));
    };
  </script>
</body>
</html>
